<template>
	<div class="schedule-far" v-if="entries" :class="roomStatusClass">
		<div class="bg-current"></div>
		<div class="room-status-info">
			<div v-if="roomStatusTimeAmount === Infinity">
				<div class="room-status-time-free">
					FREE
				</div>
			</div>
			<div v-else>
				<div class="room-status-soon">
					<div v-if="roomStatusClass !== 'free' && roomStatusClass !== 'occupied'">Soon</div>
					<div v-else>&nbsp</div>
				</div>
				<div class="room-status-intro-text">
					{{ roomStatusText }}
				</div>
				<div id="svg-wrapper">
					<svg v-if="roomStatusClass == 'occupied'" width="89px" height="22px" viewBox="0 0 89 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
						<g id="Iteration-3" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
								<g id="Busy-Far" transform="translate(-341.000000, -527.000000)" fill="#FFFFF0">
										<g id="Group" transform="translate(293.000000, 445.000000)">
												<rect id="Rectangle" x="48" y="82" width="89" height="22" rx="9"></rect>
										</g>
								</g>
						</g></svg>
					<svg v-else-if="roomStatusClass == 'free-soon' || roomStatusClass == 'occupied-soon'" width="67px" height="99px" viewBox="0 0 67 99" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
							<defs>
									<polygon id="path-1" points="0 0.979413861 66.657 0.979413861 66.657 99 0 99"></polygon>
							</defs>
							<g id="Iteration-3" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
									<g id="Soon-Busy-Far" transform="translate(-352.000000, -486.000000)">
											<g id="Group" transform="translate(293.000000, 445.000000)">
													<g id="Hour-Glass" transform="translate(59.000000, 41.000000)">
															<path d="M47.1732003,33 L33.4995011,33.0059407 L19.824804,33 C18.9636493,33 18.2671418,33.692091 18.2671418,34.5445808 C18.2671418,34.9921132 18.4577334,35.3950904 18.7660727,35.6762833 L18.7511048,35.7139077 L29.7535282,46.1022039 C29.7824661,46.1299271 29.8104063,46.1596306 29.8393443,46.1883439 C29.8682823,46.2180474 29.899216,46.2447806 29.9271561,46.274484 C29.9321454,46.2794346 29.9341411,46.2843852 29.9401283,46.2893358 C29.9820385,46.3329009 30.0209551,46.3774561 30.0628653,46.4210212 C30.086814,46.4467642 30.1117605,46.4734973 30.1357092,46.5012206 C30.1766215,46.5497363 30.2185317,46.6012223 30.259444,46.6507281 C30.2794013,46.6744909 30.2983607,46.6972635 30.3183179,46.7210263 C30.3582324,46.7735024 30.397149,46.8269687 30.4370634,46.8814251 C30.4550249,46.9051879 30.4709907,46.9279605 30.4879544,46.9517233 C30.5248753,47.0041995 30.5598004,47.0566756 30.5937277,47.1101419 C30.6116892,47.1358849 30.6286529,47.1616279 30.6456165,47.1873709 C30.6775481,47.2368767 30.707484,47.2883627 30.736422,47.3398488 C30.7533856,47.3695522 30.772345,47.4002458 30.7903065,47.4299493 C30.8162509,47.4764847 30.8392017,47.5240103 30.866144,47.5705458 C30.8851033,47.6061899 30.9040627,47.6428242 30.9220242,47.6774783 C30.9439772,47.7190631 30.9629366,47.7616381 30.9838917,47.8061933 C31.0048468,47.8467881 31.0238061,47.888373 31.0407698,47.9299578 C31.0587313,47.9685724 31.0717035,48.008177 31.0886671,48.0458014 C31.1096222,48.093327 31.1285816,48.1408525 31.1465431,48.1883781 C31.1595153,48.2200618 31.1714897,48.255706 31.183464,48.2893699 C31.2004277,48.3418461 31.219387,48.3943222 31.2373485,48.4477885 C31.2473272,48.4774919 31.2573058,48.5101658 31.2642908,48.5408594 C31.2822523,48.597296 31.299216,48.6527425 31.3151818,48.7101692 C31.3221668,48.7388825 31.3301497,48.7695761 31.3371347,48.7963093 C31.3521026,48.8567063 31.3660727,48.9161133 31.3790449,48.9755202 C31.3860299,49.0042336 31.3920171,49.0339371 31.3970064,49.0616603 C31.4089808,49.1220574 31.421953,49.1814643 31.4309337,49.2428515 C31.4369209,49.272555 31.4409123,49.3042387 31.4459016,49.3359224 C31.4548824,49.3933492 31.4638632,49.451766 31.4708482,49.5091927 C31.4758375,49.5438468 31.4778332,49.5794909 31.4808268,49.6121648 C31.486814,49.6676113 31.493799,49.7220676 31.4987883,49.7785042 C31.500784,49.8171188 31.500784,49.8557333 31.5037776,49.896328 C31.5057733,49.9458338 31.5087669,49.9973199 31.5107627,50.0478158 L31.5107627,50.1824715 L31.5107627,65.5886751 C31.5107627,69.4956725 29.0679971,70.4659861 27.4464718,70.9244098 C23.591732,72.0174977 12.7110478,74.1106028 11.2631504,74.3868451 C11.2192445,74.394766 11.1763364,74.4036771 11.1324305,74.4125881 C11.1124733,74.4145684 11.1014968,74.4185288 11.1014968,74.4185288 L11.1014968,74.4205091 C9.89907341,74.7036822 9,75.7769679 9,77.0561976 L9,82.6711449 L9,88.2860923 C9,89.7821574 10.2263721,91 11.7341411,91 L33.4995011,91 L55.2668567,91 C56.7756237,91 58,89.7821574 58,88.2860923 L58,82.6711449 L58,77.0561976 C58,75.7769679 57.1019244,74.7026921 55.8985032,74.4205091 L55.9004989,74.4185288 C55.9004989,74.4185288 55.8865289,74.4145684 55.8685674,74.4125881 C55.8266572,74.402687 55.7837491,74.3937759 55.7388453,74.3868451 C54.297933,74.1106028 43.4102637,72.0165076 39.554526,70.9244098 C37.9339986,70.4659861 35.4942267,69.4966626 35.4902352,65.5946158 L35.4902352,50.1824715 L35.4902352,50.0478158 C35.4922309,49.99831 35.4952245,49.9468239 35.4982181,49.8973182 C35.5012117,49.8587036 35.5022096,49.819099 35.5042053,49.7794944 C35.5081967,49.7230578 35.5151818,49.6686014 35.5201711,49.614145 C35.5231646,49.5804811 35.528154,49.545827 35.5311475,49.5111729 C35.5401283,49.4537462 35.5481112,49.3953294 35.5550962,49.3379027 C35.5630791,49.306219 35.5650748,49.2745352 35.5700641,49.2438416 C35.5830364,49.1824545 35.5940128,49.1220574 35.6059872,49.0626504 C35.6109765,49.0359173 35.6169636,49.0052237 35.621953,48.9775005 C35.635923,48.9180935 35.6508909,48.8586866 35.6668567,48.7982895 C35.6738418,48.7705662 35.6808268,48.7398727 35.6878118,48.7121494 C35.7047755,48.6547227 35.7187455,48.5982861 35.7377049,48.5428396 C35.7486814,48.5131361 35.7576622,48.4804623 35.7646472,48.4497687 C35.7846044,48.3963024 35.8015681,48.3438263 35.8205274,48.2913501 C35.8334996,48.2576862 35.8444761,48.2230321 35.8564505,48.1893682 C35.8754098,48.1428328 35.8933713,48.0953072 35.9143264,48.0467915 C35.9312901,48.0091671 35.9442623,47.9695625 35.9632217,47.9319381 C35.9811832,47.8903532 36.0011404,47.8497584 36.0210976,47.8071835 C36.0410549,47.7646085 36.0590164,47.7220335 36.0819672,47.6784684 C36.0999287,47.6428242 36.1178902,47.60718 36.1358517,47.5715359 C36.1637919,47.5250004 36.1857448,47.4774749 36.213685,47.4309394 C36.2326443,47.4012359 36.249608,47.3715325 36.2665716,47.341829 C36.2965075,47.290343 36.3274412,47.2388569 36.3583749,47.1893511 C36.3763364,47.1636081 36.3913043,47.1388552 36.4102637,47.1121221 C36.4431932,47.0586558 36.4791162,47.0061797 36.5150392,46.9537035 C36.5339986,46.9299408 36.5489665,46.9071681 36.5679259,46.8834053 C36.6058446,46.8299391 36.6447612,46.7764728 36.6846757,46.7239967 C36.7056308,46.7002339 36.7235923,46.6774612 36.7435495,46.6536984 C36.7844619,46.6032025 36.8263721,46.5517165 36.8682823,46.5032008 C36.8912331,46.4764677 36.9171775,46.4497345 36.9411262,46.4239915 C36.9810406,46.3804264 37.0199572,46.3368613 37.0628653,46.2923061 C37.0668567,46.2873555 37.071846,46.282405 37.0768354,46.2774544 C37.1037776,46.2477509 37.1357092,46.2200277 37.1646472,46.1913143 C37.1925873,46.163591 37.2205274,46.1319073 37.2514612,46.1051742 L48.2528867,35.7168781 L48.2369209,35.6792537 C48.5452602,35.3970706 48.7358517,34.9950836 48.7358517,34.5475512 C48.733856,33.692091 48.0333571,33 47.1732003,33" id="Fill-1" fill="#FFFFFF"></path>
															<g id="Group-5">
																	<mask id="mask-2" fill="white">
																			<use xlink:href="#path-1"></use>
																	</mask>
																	<g id="Clip-4"></g>
																	<path d="M60.5146,24.5629782 C60.5146,26.8321366 59.3996,28.7288198 56.5486,31.2783149 C56.4586,31.3459485 56.3706,31.417503 56.2886,31.4959188 L38.9016,47.8162158 C38.8826,47.831899 38.8706,47.8485624 38.8556,47.8632653 C38.8396,47.8789485 38.8246,47.8907109 38.8066,47.9083545 C38.7856,47.9289386 38.7696,47.9514832 38.7476,47.9740277 C38.7126,48.0132356 38.6756,48.0534238 38.6426,48.0945921 C38.6126,48.1318396 38.5806,48.1720277 38.5526,48.2102554 C38.5226,48.2514238 38.4906,48.2935723 38.4606,48.3386614 C38.4346,48.3798297 38.4076,48.4200178 38.3826,48.4621663 C38.3566,48.505295 38.3306,48.5484238 38.3066,48.5935129 C38.2826,48.6366416 38.2616,48.6807505 38.2406,48.7258396 C38.2186,48.7689683 38.1996,48.8130772 38.1806,48.8581663 C38.1606,48.9042356 38.1436,48.9512851 38.1256,48.9983347 C38.1106,49.0424436 38.0966,49.0865525 38.0816,49.1316416 C38.0676,49.1786911 38.0546,49.227701 38.0426,49.2757307 C38.0306,49.3218 38.0206,49.3659089 38.0126,49.4119782 C38.0026,49.4619683 37.9936,49.5090178 37.9876,49.5590079 C37.9826,49.6060574 37.9736,49.6521267 37.9686,49.6991762 C37.9636,49.7472059 37.9606,49.7962158 37.9586,49.8442455 C37.9556,49.8922752 37.9556,49.9412851 37.9556,49.9893149 C37.9556,50.0363644 37.9576,50.0843941 37.9596,50.1324238 C37.9626,50.1814337 37.9646,50.2294634 37.9706,50.2784733 C37.9756,50.3255228 37.9826,50.3715921 37.9896,50.4176614 C37.9966,50.4666713 38.0046,50.5166614 38.0146,50.5656713 C38.0236,50.6097802 38.0336,50.6558495 38.0446,50.7009386 C38.0556,50.7509287 38.0696,50.7989584 38.0836,50.8469881 C38.0976,50.8901168 38.1116,50.9361861 38.1286,50.9793149 C38.1476,51.0273446 38.1616,51.0743941 38.1806,51.1204634 C38.2016,51.1645723 38.2196,51.2096614 38.2436,51.2527901 C38.2636,51.296899 38.2856,51.3419881 38.3066,51.3851168 C38.3316,51.4302059 38.3566,51.4733347 38.3836,51.5164634 C38.4096,51.5576317 38.4346,51.5978198 38.4606,51.6399683 C38.4916,51.683097 38.5236,51.7232851 38.5546,51.7673941 C38.5816,51.8056218 38.6126,51.8448297 38.6436,51.8840376 C38.6766,51.9252059 38.7126,51.9634337 38.7496,52.004602 C38.7696,52.0261663 38.7856,52.0496911 38.8086,52.069295 C38.8246,52.0869386 38.8396,52.0967406 38.8556,52.113404 C38.8706,52.1300673 38.8846,52.1467307 38.9026,52.1624139 L56.2906,68.4827109 C56.3726,68.5601465 56.4576,68.6307208 56.5476,68.6993347 C59.4006,71.2478495 60.5166,73.1464931 60.5166,75.4156515 L60.5166,87.7122356 C60.5166,90.6165624 58.1086,92.9768792 55.1446,92.9768792 L33.3276,92.9768792 L11.5136,92.9768792 C8.5506,92.9768792 6.1406,90.6165624 6.1406,87.7122356 L6.1406,75.4136911 C6.1406,73.1455129 7.2576,71.2488297 10.1076,68.6973743 C10.1986,68.6307208 10.2856,68.5572059 10.3676,68.4807505 L27.7546,52.1604535 C27.7716,52.1447703 27.7856,52.1281069 27.8016,52.1114436 C27.8166,52.0938 27.8326,52.0849782 27.8476,52.0673347 C27.8686,52.0467505 27.8846,52.0242059 27.9056,52.0036218 C27.9416,51.9644139 27.9796,51.9232455 28.0146,51.8820772 C28.0426,51.8448297 28.0736,51.8046416 28.1016,51.7673941 C28.1326,51.7242653 28.1666,51.6821168 28.1956,51.6380079 C28.2226,51.5978198 28.2476,51.5586119 28.2726,51.5174436 C28.2986,51.4723545 28.3246,51.4292257 28.3496,51.3831564 C28.3716,51.3400277 28.3936,51.296899 28.4146,51.2537703 C28.4356,51.207701 28.4556,51.1645723 28.4756,51.1194832 C28.4956,51.0734139 28.5136,51.0263644 28.5286,50.9793149 C28.5456,50.9342257 28.5586,50.891097 28.5746,50.8450277 C28.5876,50.7960178 28.6006,50.7489683 28.6136,50.7019188 C28.6236,50.6558495 28.6346,50.6097802 28.6426,50.5637109 C28.6526,50.514701 28.6616,50.4656911 28.6676,50.4186416 C28.6746,50.3715921 28.6816,50.3255228 28.6866,50.2784733 C28.6916,50.2284832 28.6956,50.1814337 28.6996,50.133404 C28.7006,50.0853743 28.7016,50.0363644 28.7016,49.990295 C28.7016,49.9422653 28.7006,49.8942356 28.6996,49.8462059 C28.6966,49.7991564 28.6926,49.7491663 28.6866,49.7011366 C28.6816,49.6540871 28.6756,49.6080178 28.6676,49.5609683 C28.6606,49.5119584 28.6526,49.4639287 28.6426,49.4139386 C28.6336,49.3678693 28.6226,49.3237604 28.6136,49.2776911 C28.6006,49.2296614 28.5876,49.1816317 28.5746,49.133602 C28.5586,49.0885129 28.5446,49.0434238 28.5286,48.9983347 C28.5136,48.9532455 28.4956,48.9052158 28.4756,48.8591465 C28.4556,48.8150376 28.4366,48.7709287 28.4146,48.7258396 C28.3936,48.6807505 28.3716,48.638602 28.3496,48.5944931 C28.3256,48.5503842 28.3006,48.5062752 28.2726,48.4621663 C28.2476,48.420998 28.2236,48.3817901 28.1956,48.3406218 C28.1666,48.2965129 28.1336,48.2533842 28.1016,48.2112356 C28.0736,48.1730079 28.0426,48.1347802 28.0146,48.0975327 C27.9786,48.0563644 27.9416,48.015196 27.9056,47.9750079 C27.8846,47.9544238 27.8686,47.9318792 27.8476,47.9103149 C27.8326,47.8946317 27.8166,47.8818891 27.8006,47.8662059 C27.7846,47.8495426 27.7716,47.8338594 27.7556,47.8181762 L10.3676,31.4988594 C10.2856,31.422404 10.1996,31.3508495 10.1106,31.284196 C7.2566,28.734701 6.1426,26.8370376 6.1426,24.566899 L6.1426,12.2693347 C6.1426,9.36598812 8.5516,7.00371089 11.5146,7.00371089 L33.3276,7.00371089 L55.1426,7.00371089 C58.1056,7.00371089 60.5136,9.36598812 60.5136,12.2693347 L60.5136,24.5629782 L60.5146,24.5629782 Z M55.1426,0.979413861 L33.3276,0.979413861 L11.5136,0.979413861 C5.1636,0.979413861 -0.0004,6.04311683 -0.0004,12.2634535 L-0.0004,24.5659188 L-0.0004,24.566899 C-0.0004,26.8938891 0.6646,29.1267802 1.9736,31.2038198 C2.9436,32.7397901 4.2806,34.2375327 6.1826,35.9156317 C6.2226,35.9489584 6.2616,35.9832653 6.3036,36.0146317 L21.1906,49.9893149 L6.3046,63.9630178 C6.2626,63.9953644 6.2226,64.0286911 6.1826,64.062998 C3.3066,66.6017109 0.0016,70.1813941 -0.0004,75.4107505 L-0.0004,75.4127109 L-0.0004,87.7151762 C-0.0004,93.9374733 5.1636,99.000196 11.5136,99.000196 L33.3276,99.000196 L55.1426,99.000196 C61.4926,99.000196 66.6566,93.9374733 66.6566,87.7151762 L66.6566,75.4127109 L66.6566,75.4107505 C66.6556,73.0827802 65.9916,70.8508693 64.6816,68.7748099 C63.7106,67.2378594 62.3736,65.7401168 60.4716,64.0620178 C60.4326,64.0286911 60.3926,63.9953644 60.3506,63.9620376 L45.4646,49.9893149 L60.3516,36.0156119 C60.3926,35.9832653 60.4336,35.9499386 60.4726,35.9156317 C63.3506,33.377899 66.6556,29.7962554 66.6576,24.5688594 L66.6576,24.566899 L66.6576,12.2634535 C66.6566,6.04311683 61.4926,0.979413861 55.1426,0.979413861 Z" id="Fill-3" fill="#FFFFFF" mask="url(#mask-2)"></path>
															</g>
													</g>
											</g>
									</g>
							</g></svg>
					<svg v-else-if="roomStatusClass == 'free'" width="201px" height="201px" viewBox="0 0 201 201" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>
				</div>
				<timer-icon :entries="entries"></timer-icon>
				<div class="room-status-time">
					<div v-if="roomStatusClass == 'free-soon' || roomStatusClass == 'occupied-soon'">In&nbsp</div>
					<div v-else-if="roomStatusClass == 'occupied' || roomStatusClass == 'free'">For&nbsp</div>
					<div class="room-status-time-amount"> {{ roomStatusTimeAmount | round }}</div>
					&nbsp
					<div class="room-status-time-units">{{ roomStatusTimeUnits }}</div>
				</div>
			</div>
		</div>
	</div>
</template>

<script>
	import {getCurrentEntry, getProgressUntilEntryEnd, getProgressUntilNextEntry, getNextEntry, getNextFreeTime} from '@/services/calendarService'
	import TimerIcon from './TimerIcon'

	export default {
		props: {
			entries: Array
		},
		components: {
			TimerIcon
		},
		computed: {
			currentEntry() {
				return getCurrentEntry(this.entries)
			},
			nextEntry() {
				return getNextEntry(this.entries)
			},
			roomStatusText() {
				if (this.currentEntry && (this.timeRemaining / 60000) > 30 ) {
					return 'BUSY'
				}
				else if ( this.currentEntry && (this.timeRemaining / 60000) <= 30) {
					return 'FREE' // soon free
				}
				else {
					if (this.nextEntry &&  getProgressUntilNextEntry(this.nextEntry) >= 0.5) {
						return 'BUSY' // soon busy
					} else {
						return 'FREE'
					}
				}
			},
			roomStatusClass() {
				if (this.currentEntry && (this.timeRemaining / 60000) > 30 ) {
					return 'occupied'
				}
				else if ( this.currentEntry && (this.timeRemaining / 60000) <= 30) {
					return 'free-soon' // soon free
				}
				else {
					if (this.nextEntry &&  getProgressUntilNextEntry(this.nextEntry) >= 0.5) {
						return 'occupied-soon' // soon busy
					} else {
						return 'free'
					}
				}
			},
			timeRemaining() {
				if (this.currentEntry) {
					const nextFreeTime = getNextFreeTime(this.entries)
					return nextFreeTime - new Date()
				} else {
					if (this.nextEntry) {
						return this.nextEntry.start - new Date()
					} else {
						return Infinity
					}
				}
			},
			roomStatusTimeAmount() {
				const seconds = this.timeRemaining / 1000
				if (seconds < 60) {
					return seconds
				} else {
					if (seconds < 3600) {
						return seconds / 60
					} else {
						if (seconds < 3600 * 24) {
							return seconds / 3600
						} else {
							return seconds / (3600 * 24)
						}
					}
				}
			},
			roomStatusTimeUnits() {
				const seconds = this.timeRemaining / 1000
				if (seconds < 60) {
					return 's'                                  // was 'seconds'
				} else {
					if (seconds < 3600) {
						return 'min'                              // was 'minutes'
					} else {
						if (seconds < 3600 * 24) {
							return 'hr'                             // was 'hours'
						} else {
							return 'days'
						}
					}
				}
			}
		},
		filters: {
			round(amount) {
				return Math.round(amount)
			}
		}
	}
</script>

<style lang="scss" scoped>
	@import 'colors';
	@import 'gradients';

	#svg-wrapper{
		position:absolute;
		left:41.5%;
		top:37.5%;
	}

	.schedule-far {
		color: white;
		height: 100%;
		text-align: center;
		display: flex;
		padding-top:55px;

		.room-status-info {
			position: relative;
			margin-left: auto;
			margin-right: auto;

		}
		.room-status-intro-text {
			font-size: 160px;
			font-weight: bold;
		}
		.room-status-soon {
			font-size: 96px;
			font-weight: bold;
			float: left;
			padding-left: 30px;
			margin-bottom:-32px;
		}
		.room-status-time-free {
			font-weight: bold;
			font-size: 160px;
			margin-top: 130px;
		}
		.room-status-time{
			font-size: 110px;
			display:flex;
			margin-top:80px;
		}
		.room-status-icon{
			// padding-top: 133px;
		}
		.room-status-time-amount,
		.room-status-time-units {
			font-size: 110px;
			font-weight: bold;
		}
		.bg-current {
			position: absolute;
			// top: -128px;
			top:0;
			left: 0;
			right: 0;
			bottom: 0;
		}
		&.occupied {
			.bg-current {
				background-image: $gradient-busy;
			}
		}
		&.free {
			.bg-current {
				background-image: $gradient-free;
			}
		}
		&.occupied-soon {
			.bg-current {
				background-image: $gradient-soon-busy;
			}
		}
		&.free-soon{
			.bg-current {
				background-image: $gradient-soon-free;
			}
		}

	}
</style>
